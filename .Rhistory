library(tidyverse)
library(readxl)
ind_pal <- c("#a6cee3", "#1f78b4", "#b2df8a", "#33a02c", "#fb9a99")
names(ind_pal) <- c("CHI", "HAR", "MSH", "SHU", "NIC")
dat <- readRDS(here::here("data", "cyer_fmi_dat.rds"))
# remove years before 2019 when FMI values are dubious
dat_trim <-  dat %>%
filter(year > 2018) %>%
mutate(
log_can_er = log(can_er),
log_fmi = log(fmi)
)
fmi_cyer_cor <- ggplot(dat_trim) +
geom_point(aes(x = fmi, y = can_er, fill = indicator), shape = 21) +
# geom_abline(aes(intercept = 0, slope = 1), linetype = 2) +
scale_fill_manual(values = ind_pal) +
ggsidekick::theme_sleek()
# fit hiearchical slopes model to fmi data with intercept fixed at 0
library(brms)
library(DHARMa)
# remove years before 2019 when FMI values are dubious
dat_trim <-  dat %>%
filter(year > 2018) %>%
mutate(
se_fmi = fmi * 0.1,
se_fmi2 = fmi * 0.2
)
glimpse(dat_trim)
# random ints
fit_brms <- brm(
can_er ~ me(fmi, se_fmi) + (1 | indicator),
data = dat_trim,
family = Beta(link = "logit"),  # Beta regression
prior = c(prior(normal(1, 5), class = "b"),  # Priors for fixed effects
prior(normal(0, 2), class = "Intercept"),  # Prior for intercept
prior(exponential(1), class = "phi")),
chains = 4, cores = 4, iter = 2000, warmup = 1000,
control = list(adapt_delta = 0.95)
)
summary(fit_brms)
